{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Pago exitoso - Videla</title>

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <!-- Estilo Videla -->
    <link rel="stylesheet" href="{% static 'estilo.css' %}">
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
               <a class="navbar-brand d-flex align-items-center" href="/">
    <img src="{% static 'logo.png' %}" alt="Videla Logo" class="logo-navbar me-2">
</a>
          <button class="navbar-toggler btn btn-sm btn-dorado" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
            ‚ò∞
          </button>
          <div class="collapse navbar-collapse" id="nav">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item"><a class="nav-link" href="{% url 'menu' %}">Men√∫</a></li>
              <li class="nav-item"><a class="nav-link" href="{% url 'promociones' %}">Promociones</a></li>
              <li class="nav-item"><a class="nav-link" href="{% url 'carrito' %}">Carrito</a></li>
            </ul>
          </div>
        </div>
    </nav>

    <!-- CONTENIDO ORIGINAL (NO CAMBIADO) -->
    <div class="container py-5">
      <div class="text-center mb-5">
        <h2 class="fw-bold text-warning">üõçÔ∏è Finalizar Compra</h2>
        <p class="text-secondary">Por favor completa tus datos para procesar tu pedido</p>
      </div>

      <div class="row g-4">

        <!-- Datos cliente -->
        <div class="col-lg-6">
          <div class="card shadow">
            <div class="card-body">
              <h4 class="text-light mb-4">Datos del Cliente</h4>

              <form id="checkoutForm" method="post" class="needs-validation" novalidate>
                {% csrf_token %}
                <div class="mb-3">
                  <label class="form-label text-light">Nombre completo</label>
                  <input type="text" name="nombre" class="form-control bg-dark text-light border-secondary" placeholder="Ej: Juan P√©rez" required>
                </div>
                <div class="mb-3">
                  <label class="form-label text-light">Correo electr√≥nico</label>
                  <input type="email" name="email" class="form-control bg-dark text-light border-secondary" placeholder="ejemplo@correo.com" required>
                </div>
                <div class="mb-3">
                  <label class="form-label text-light">Tel√©fono</label>
                  <input type="tel" name="telefono" class="form-control bg-dark text-light border-secondary" placeholder="+56 9 1234 5678" required>
                </div>
                <div class="mb-3">
                  <label class="form-label text-light">M√©todo de entrega</label>
                  <select id="tipoEntrega" name="tipo_entrega" class="form-select bg-dark text-light border-secondary" required>
                    <option value="retiro">Retiro en local</option>
                    <option value="delivery">Delivery</option>
                  </select>
                </div>
                <div class="mb-3" id="direccionBox" style="display:none;">
                  <label class="form-label text-light">Direcci√≥n de entrega</label>
                  <input type="text" name="direccion" class="form-control bg-dark text-light border-secondary" placeholder="Calle, n√∫mero y comuna">
                </div>

                <button type="submit" class="btn btn-warning w-100 fw-bold">Confirmar pedido</button>
              </form>

            </div>
          </div>
        </div>

        <!-- Resumen -->
        <div class="col-lg-6">
          <div class="card shadow">
            <div class="card-body">
              <h4 class="text-light mb-4">Resumen del Pedido</h4>

              {% if items %}
              <table class="table table-dark table-striped align-middle">
                <thead class="table-warning text-dark">
                  <tr>
                    <th>Producto</th>
                    <th class="text-end">Cant.</th>
                    <th class="text-end">Subtotal</th>
                  </tr>
                </thead>
                <tbody>
                  {% for it in items %}
                  <tr>
                    <td>{{ it.nombre }}</td>
                    <td class="text-end">{{ it.cantidad }}</td>
                    <td class="text-end">${{ it.subtotal|floatformat:0 }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
                <tfoot>
                  <tr>
                    <th colspan="2" class="text-end">Total</th>
                    <th class="text-end text-success">${{ total|floatformat:0 }}</th>
                  </tr>
                </tfoot>
              </table>

              {% if mp_init_point %}
              <div class="text-center mt-4">
                <a href="{{ mp_init_point }}" class="btn btn-primary btn-lg w-100">üí≥ Pagar con MercadoPago</a>
              </div>
              {% else %}
              <div class="text-center mt-4">
                <p class="text-warning">‚ö†Ô∏è Pago local (MercadoPago no configurado)</p>
                <button class="btn btn-success btn-lg w-100">Confirmar pedido en tienda</button>
              </div>
              {% endif %}

              {% else %}
              <p class="text-center text-muted">Tu carrito est√° vac√≠o.</p>
              {% endif %}
            </div>
          </div>
        </div>

      </div>
    </div>

    <script>
      const tipoEntrega = document.getElementById("tipoEntrega");
      const direccionBox = document.getElementById("direccionBox");
      tipoEntrega.addEventListener("change", () => {
        direccionBox.style.display = tipoEntrega.value === "delivery" ? "block" : "none";
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
